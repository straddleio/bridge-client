import{EBridgeMessageType as e}from"@straddleio/bridge-core";const o={getUrl:()=>`${o.origin}/${encodeURIComponent("undefined"!=typeof window&&window.location.origin)}/`,origin:"",mounted:!1,verbose:!1,init:function(t){const{appUrl:d,token:n,onSuccess:l,onSuccessCTAClicked:i,targetRef:s,style:a,className:r,verbose:c=!1}=t;o.origin=null!=d?d:"https://dev.straddle.io",c&&console.log("init called");const g=document.createElement("iframe");g.setAttribute("src",o.getUrl()),g.id="Straddle-widget-iframe";let m=a;a||(m={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),Object.assign(g.style,m),r&&r.split(" ").forEach((e=>{g.classList.add(e)})),(s||document.getElementsByTagName("body")[0]).appendChild(g),"undefined"!=typeof window&&window.addEventListener("message",(function(t){var d;if(t.origin===o.origin)switch(c&&console.log("Message received from widget:",t.data.type,t),null===(d=t.data)||void 0===d?void 0:d.type){case e.MOUNTED:o.mounted||(o.mounted=!0,o.send({type:e.INITIALIZE,token:n}));break;case e.ON_SUCCESS_CTA_CLICKED:document.getElementsByTagName("body")[0].removeChild(g),null==i||i();break;case e.ON_PAYKEY:null==l||l(t.data);break;case"@straddleio/bridge-js/console":alert(t.data.method);{const e=t.data.payload.map((e=>{try{return JSON.parse(e)}catch(o){return e}}));console[t.data.method].apply(console,e)}}}))},getIframe:()=>document.getElementById("Straddle-widget-iframe"),show:()=>{o.verbose&&console.log("straddleBridge.show method called.");const e=o.getIframe();o.verbose&&e&&console.log("iframe found, setting display to block."),e.style.display="block"},hide:()=>{o.verbose&&console.log("straddleBridge.hide method called.");const e=o.getIframe();o.verbose&&e&&console.log("iframe found, setting display to none."),e.style.display="none"},remove:()=>{o.verbose&&console.log("straddleBridge.remove method called.");o.getIframe().remove(),o.mounted=!1},send:function(e){var t;const d=document.getElementById("Straddle-widget-iframe");console.log("sending message:",e),null===(t=null==d?void 0:d.contentWindow)||void 0===t||t.postMessage(e,o.origin)}};"undefined"!=typeof window&&(window.straddleBridge=o),Object.defineProperty(o,"debug",{value:{enable:()=>o.send({type:e.DEBUG,enable:!0}),disable:()=>o.send({type:e.DEBUG,enable:!1})},enumerable:!1,writable:!1,configurable:!1});export{o as straddleBridge};
