"use strict";var e=require("@straddleio/bridge-core"),t=require("react");const d="Straddle-widget-iframe",r=({appUrl:e})=>{const[r,a]=t.useState(!1),[n,o]=t.useState(!1),i=`${e}/${s()}/`;return{send:e=>{var t;const r=document.getElementById(d);r&&(null===(t=r.contentWindow)||void 0===t||t.postMessage(e,i))},iframeMounted:r,setIframeMounted:a,bridgeAppMounted:n,setBridgeAppMounted:o,url:i}},s=()=>"undefined"!=typeof window&&encodeURIComponent(window.location.origin),a=t.forwardRef(((s,a)=>{const{appUrl:n,open:o=!0,token:i,onSuccess:l,onSuccessCTAClicked:c,onClose:p,className:u,style:g,verbose:y}=s,{send:m,iframeMounted:f,setIframeMounted:E,bridgeAppMounted:M,setBridgeAppMounted:b,url:B}=r({appUrl:n});return t.useEffect((()=>{var t;if(o&&!f){E(!0);const t=document.createElement("iframe");t.setAttribute("src",B),t.id=d;let r=g;g||(r={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),r&&Object.assign(t.style,r),u&&u.split(" ").forEach((e=>{t.classList.add(e)})),a&&"current"in a?a.current.appendChild(t):document.getElementsByTagName("body")[0].appendChild(t),window.addEventListener("message",(function(t){var r,s;if(t.origin===n)switch(y&&console.log("Message received from widget:",t.data.type,t),null===(r=t.data)||void 0===r?void 0:r.type){case e.EBridgeMessageType.PING:break;case e.EBridgeMessageType.MOUNTED:M||(b(!0),m({type:e.EBridgeMessageType.INITIALIZE,token:i}));break;case e.EBridgeMessageType.ON_CLOSE:null==p||p(),b(!1),null===(s=document.querySelector(`#${d}`))||void 0===s||s.remove();break;case e.EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:null==c||c();break;case e.EBridgeMessageType.ON_PAYKEY:null==l||l(t.data);break;case"@straddleio/bridge-js/log":{const e=t.data.payload.map((e=>{try{return JSON.parse(e)}catch(t){return e}}));console[t.data.method].apply(console,e)}}}))}else!o&&f&&(null===(t=document.querySelector(`#${d}`))||void 0===t||t.remove(),E(!1),b(!1))}),[o,M]),t.useEffect((()=>{"undefined"!=typeof window&&(window.verbose={enable:()=>m({type:e.EBridgeMessageType.DEBUG,enable:!0}),disable:()=>m({type:e.EBridgeMessageType.DEBUG,enable:!1})})}),[]),null}));a.displayName="StraddleBridge",exports.StraddleBridge=a,exports.useStraddleBridge=r;
//# sourceMappingURL=index.js.map
