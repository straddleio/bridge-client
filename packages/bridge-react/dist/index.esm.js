import{EBridgeMessageType as e}from"@straddleio/bridge-core";import{forwardRef as t,useRef as r,useEffect as n,useState as o}from"react";const d="Straddle-widget-iframe",a=({appUrl:e})=>{const[t,r]=o(!1),[n,a]=o(!1),i=`${e}/${s()}/`;return{send:e=>{var t;const r=document.getElementById(d);r&&(null===(t=r.contentWindow)||void 0===t||t.postMessage(e,i))},iframeMounted:t,setIframeMounted:r,bridgeAppMounted:n,setBridgeAppMounted:a,url:i}},s=()=>"undefined"!=typeof window&&encodeURIComponent(window.location.origin),i=t(((t,o)=>{const{appUrl:s,open:i=!0,token:l,onSuccess:c,onSuccessCTAClicked:u,onClose:p,onLoadError:m,className:g,style:f,verbose:b}=t,{send:y,setIframeMounted:v,bridgeAppMounted:w,setBridgeAppMounted:E,url:S}=a({appUrl:s}),C=r(!1);return n((()=>{var t;if(i&&!C.current){C.current=!0;const t=document.createElement("iframe");t.setAttribute("src",S),t.setAttribute("src",S),t.addEventListener("error",(()=>{console.error("Error loading Straddle iframe"),null==m||m()})),t.id=d;let r=f;f||(r={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),r&&Object.assign(t.style,r),g&&g.split(" ").forEach((e=>{t.classList.add(e)})),o&&"current"in o&&o.current&&o.current instanceof Node?o.current.appendChild(t):(!o||!("current"in o)||o.current&&o.current instanceof Node||console.warn("ref passed to StraddleBridge is not a valid ref, reverting to appening to body. Ref passed:",o.current),document.getElementsByTagName("body")[0].appendChild(t)),window.addEventListener("message",(function(t){var r,n;if(t.origin===s)switch(b&&"@straddleio/bridge-js/console"!==t.data.type&&console.log("Straddle Bridge React client, Message received from widget:",t.data.type,t),null===(r=t.data)||void 0===r?void 0:r.type){case e.PING:break;case e.MOUNTED:w||(E(!0),y({type:e.INITIALIZE,token:l}));break;case e.ON_CLOSE:null==p||p(),E(!1),null===(n=document.querySelector(`#${d}`))||void 0===n||n.remove();break;case e.ON_SUCCESS_CTA_CLICKED:null==u||u();break;case e.ON_PAYKEY:null==c||c(t.data);break;case"@straddleio/bridge-js/console":{const e=t.data.payload.map((e=>{try{return JSON.parse(e)}catch(t){return e}}));console[t.data.method].apply(console,e)}}}))}else!i&&C&&(null===(t=document.querySelector(`#${d}`))||void 0===t||t.remove(),v(!1),C.current=!1,E(!1))}),[i,w]),n((()=>{"undefined"!=typeof window&&(window.verbose={enable:()=>y({type:e.DEBUG,enable:!0}),disable:()=>y({type:e.DEBUG,enable:!1})})}),[]),null}));i.displayName="StraddleBridge";export{i as StraddleBridge,a as useStraddleBridge};
//# sourceMappingURL=index.esm.js.map
