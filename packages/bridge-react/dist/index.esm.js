import{EBridgeMessageType as e}from"@straddleio/bridge-core";import{forwardRef as t,useEffect as o,useState as n}from"react";const d="Straddle-widget-iframe",r=({appUrl:e})=>{const[t,o]=n(!1),[r,s]=n(!1),i=`${e}/${a()}/`;return{send:e=>{var t;const o=document.getElementById(d);o&&(null===(t=o.contentWindow)||void 0===t||t.postMessage(e,i))},iframeMounted:t,setIframeMounted:o,bridgeAppMounted:r,setBridgeAppMounted:s,url:i}},a=()=>"undefined"!=typeof window&&encodeURIComponent(window.location.origin),s=t(((t,n)=>{const{appUrl:a,open:s=!0,token:i,onSuccess:l,onSuccessCTAClicked:c,onClose:p,className:u,style:m,verbose:g}=t,{send:f,iframeMounted:b,setIframeMounted:y,bridgeAppMounted:w,setBridgeAppMounted:v,url:E}=r({appUrl:a});return o((()=>{var t;if(s&&!b){y(!0);const t=document.createElement("iframe");t.setAttribute("src",E),t.id=d;let o=m;m||(o={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),o&&Object.assign(t.style,o),u&&u.split(" ").forEach((e=>{t.classList.add(e)})),n&&"current"in n?n.current.appendChild(t):document.getElementsByTagName("body")[0].appendChild(t),window.addEventListener("message",(function(t){var o,n;if(t.origin===a)switch(g&&console.log("Message received from widget:",t.data.type,t),null===(o=t.data)||void 0===o?void 0:o.type){case e.PING:break;case e.MOUNTED:w||(v(!0),f({type:e.INITIALIZE,token:i}));break;case e.ON_CLOSE:null==p||p(),v(!1),null===(n=document.querySelector(`#${d}`))||void 0===n||n.remove();break;case e.ON_SUCCESS_CTA_CLICKED:null==c||c();break;case e.ON_PAYKEY:null==l||l(t.data);break;case"@straddleio/bridge-js/log":{const e=t.data.payload.map((e=>{try{return JSON.parse(e)}catch(t){return e}}));console[t.data.method].apply(console,e)}}}))}else!s&&b&&(null===(t=document.querySelector(`#${d}`))||void 0===t||t.remove(),y(!1),v(!1))}),[s,w]),o((()=>{"undefined"!=typeof window&&(window.verbose={enable:()=>f({type:e.DEBUG,enable:!0}),disable:()=>f({type:e.DEBUG,enable:!1})})}),[]),null}));s.displayName="StraddleBridge";export{s as StraddleBridge,r as useStraddleBridge};
//# sourceMappingURL=index.esm.js.map
