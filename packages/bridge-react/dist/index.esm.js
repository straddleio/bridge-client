import{EBridgeMessageType as e}from"@straddleio/bridge-core";import{forwardRef as n,useRef as t,useEffect as r,useState as o}from"react";const d="Straddle-widget-iframe",a=({appUrl:e})=>{const[n,t]=o(!1),[r,a]=o(!1);console.log({bridgeAppMounted:r});const l=`${e}/${s()}/`;return{send:e=>{var n;const t=document.getElementById(d);t&&(null===(n=t.contentWindow)||void 0===n||n.postMessage(e,l))},iframeMounted:n,setIframeMounted:t,bridgeAppMounted:r,setBridgeAppMounted:a,url:l}},s=()=>"undefined"!=typeof window&&encodeURIComponent(window.location.origin),l=n(((n,o)=>{const{appUrl:s,open:l=!0,token:i,onSuccess:c,onSuccessCTAClicked:u,onClose:p,onLoadError:m,onManualEntry:g,onRetry:y,className:f,style:b,verbose:E}=n,{send:N,setIframeMounted:v,bridgeAppMounted:w,setBridgeAppMounted:S,url:C}=a({appUrl:s}),M=t(!1);return r((()=>{var n;if(l&&!M.current){M.current=!0;const n=document.createElement("iframe");n.setAttribute("src",C),n.addEventListener("error",(e=>{console.error("Error loading Straddle Widget"),null==m||m(e)})),n.id=d;let t=b;b||(t={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),t&&Object.assign(n.style,t),f&&f.split(" ").forEach((e=>{n.classList.add(e)})),o&&"current"in o&&o.current&&o.current instanceof Node?o.current.appendChild(n):(!o||!("current"in o)||o.current&&o.current instanceof Node||console.warn("ref passed to StraddleBridge is not a valid ref, reverting to appening to body. Ref passed:",o.current),document.getElementsByTagName("body")[0].appendChild(n)),window.addEventListener("message",(function(n){var t;if(n.origin===s){E&&n.data.type!==e.CONSOLE&&console.log("Straddle Bridge React client, Message received from widget:",n.data.type,n);const r=n.data;switch(null==r?void 0:r.type){case e.PING:break;case e.MOUNTED:S(!0),N({type:e.INITIALIZE,token:i});break;case e.ON_CLOSE:null==p||p(),S(!1),null===(t=document.querySelector(`#${d}`))||void 0===t||t.remove();break;case e.ON_SUCCESS_CTA_CLICKED:null==u||u();break;case e.ON_PAYKEY:null==c||c(r.paykeyResponse);break;case e.ON_MANUAL_ENTRY:null==g||g();break;case e.ON_RETRY:null==y||y();break;case e.CONSOLE:{const e=r.payload.map((e=>{try{return JSON.parse(e)}catch(n){return e}}));"method"in r&&console[r.method].apply(console,e)}}}}))}else!l&&M&&(null===(n=document.querySelector(`#${d}`))||void 0===n||n.remove(),v(!1),M.current=!1,S(!1))}),[l,w]),r((()=>{"undefined"!=typeof window&&(window.verbose={enable:()=>N({type:e.DEBUG,enable:!0}),disable:()=>N({type:e.DEBUG,enable:!1})})}),[]),null}));l.displayName="StraddleBridge";export{l as StraddleBridge,a as useStraddleBridge};
//# sourceMappingURL=index.esm.js.map
